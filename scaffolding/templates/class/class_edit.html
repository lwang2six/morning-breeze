{% load scaffold_tags %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-1.7.2.min.js"></script>

<form method="post" action="">{% csrf_token %}
<table id='b'>
{% for field in form %}
    <tr><th>{{field.label_tag}}</th><td>{{field}}</td></tr>
{% endfor %} 
{% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}

{{formset.management_form}}
{% for f in formset.forms %}

    <tr class="{{f.prefix}}_name_row"><th>{{f.name.label_tag}}</th><td>{{f.name}}</td></tr>
    <tr class="{{f.prefix}}_type_row"><th>{{f.type.label_tag}}</th><td>{{f.type}}</td></tr>
    {% if f.option_fk_name %}
      <tr class="{{f.prefix}}_option_fk_name_row"><th>{{f.option_fk_name.label_tag}}</th><td>{{f.option_fk_name}}</td></tr>
    {% endif %}
    <tr class="{{f.prefix}}_options_row"><th>{{f.options.label_tag}}</th><td><div class="id_{{f.prefix}}_choice_list"> {{f.options}}</div></td></tr>
    <script>$('#id_{{f.prefix}}-type').change(function(){
            $("#id_{{f.prefix}}-type option:selected").each(function(){

                var x = $(this).text();
                var field;
                if(x=='BooleanField'){
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "boolean" f.prefix%}';
                }
                else if(x == 'CharField'){
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "char" f.prefix%}';
                }
                else if(x == 'DateTimeField'){
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "datetime" f.prefix%}';
                }
                else if(x == 'FileField'){
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "file" f.prefix%}';
                }
                else if(x == 'ForeignKey'){
                    $('.{{f.prefix}}_type_row').after('<tr class="{{f.prefix}}_option_fk_name_row"><th><label for="id_{{f.prefix}}-option_fk_name">Foreign Key Class</label></th><td><input type="text" name="{{f.prefix}}-option_fk_name" id="id_{{f.prefix}}-option_fk_name"/></td></tr>');
                    field = '{% doSome "fk" f.prefix%}';
                }
                else if(x == 'IntegerField'){
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "int" f.prefix%}';
                }
                else if(x == 'ImageField'){
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "image" f.prefix%}';
                }
                else if(x == 'PositiveIntegerField'){
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "pint" f.prefix%}';
                }
                else if(x == 'TextField'){
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "text" f.prefix%}';
                }
                else {
                    $('.{{f.prefix}}_option_fk_name_row').remove()
                    field = '{% doSome "default" f.prefix%}';
                }
                $('.id_{{f.prefix}}_choice_list').replaceWith(field);
            });
       });
    </script>
  {% for hidden in f.hidden_fields %}{{ hidden }}{% endfor %}

{% endfor %}
</table>

<input type="button" id="one_more" value="Add Another">
<input type="submit" value="Submit" name="save" class="button" />
</form>
{{formset.total_form_count}}
<script>
  $(document).ready(function(){
      $('#one_more').click(function(){
          var v = +$('#id_field_set-TOTAL_FORMS').val();
          var extras = [];
          extras.push('<tr><th><label for="id_field_set-',v,'-name">Name:</label></th><td><input id="id_field_set-',v,'-name" type="text" maxlength="30" name="field_set-',v,'-name"></td></tr><tr><th><label for="id_field_set-',v,'-type">Type:</label></th><td><select id="id_field_set-',v,'-type" name="field_set-',v,'-type"><option selected="selected" value="">---------</option><option value="1">BooleanField</option><option value="2">CharField</option><option value="3">DateTimeField</option><option value="4">FileField</option><option value="5">ForeignKey</option><option value="6">IntegerField</option><option value="7">ImageField</option><option value="8">PositiveIntegerField</option><option value="9">TextField</option></select</td></tr><tr><th><label for="id_field_set-',v,'-options_0">Options:</label></th><td><ul><li><label for="id_field_set-',v,'-options_0"><input type="checkbox" name="field_set-',v,'-options" value="blank=True" id="id_field_set-',v,'-options_0" /> blank</label></li><li><label for="id_field_set',v,'options_1"><input type="checkbox" name="field_set',v,'options" value="choices=[]" id="id_field_set',v,'options_1" /> choices</label></li><li><label for="id_field_set',v,'options_2"><input type="checkbox" name="field_set',v,'options" value="default=&quot;&quot;" id="id_field_set',v,'options_2" /> default</label></li><li><label for="id_field_set',v,'options_3"><input type="checkbox" name="field_set',v,'options" value="editable=False" id="id_field_set',v,'options_3" /> editable</label></li><li><label for="id_field_set',v,'options_4"><input type="checkbox" name="field_set',v,'options" value="help_text=&quot;some help text for this field&quot;" id="id_field_set',v,'options_4" /> help text</label></li><li><label for="id_field_set',v,'options_5"><input type="checkbox" name="field_set',v,'options" value="max_length=1" id="id_field_set',v,'options_5" /> max length</label></li><li><label for="id_field_set',v,'options_6"><input type="checkbox" name="field_set',v,'options" value="null=True" id="id_field_set',v,'options_6" /> null</label></li><li><label for="id_field_set',v,'options_7"><input type="checkbox" name="field_set',v,'options" value="related_name=&quot;some_special_name&quot;" id="id_field_set',v,'options_7" /> related name</label></li><li><label for="id_field_set',v,'options_8"><input type="checkbox" name="field_set',v,'options" value="unique=False" id="id_field_set',v,'options_8" /> unique</label></li><li><label for="id_field_set',v,'options_9"><input type="checkbox" name="field_set',v,'options" value="verbose_name=&quot;display name&quot;" id="id_field_set',v,'options_9" /> verbose name</label></li></ul><input type="hidden" name="field_set',v,'id" id="id_field_set',v,'id" /><input type="hidden" name="field_set',v,'parent_class" value={{clas.id}} id="id_field_set',v,'parent_class" /></td></tr>')
          $('#id_field_set-TOTAL_FORMS').val(+v+1);
          $('tbody tr:last').after(extras.join(''));
      });
    });
</script>
